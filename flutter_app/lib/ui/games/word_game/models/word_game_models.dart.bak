import 'package:freezed_annotation/freezed_annotation.dart';

part 'word_game_models.freezed.dart';

enum WordGameMode {
  pictureToText('Picture→Text', 'えをみてもじをえらぶ'),
  textToPicture('Text→Picture', 'もじをみてえをえらぶ');

  final String displayName;
  final String description;

  const WordGameMode(this.displayName, this.description);
}

enum WordGamePhase {
  ready,
  displaying,
  questioning,
  processing,
  feedbackOk,
  feedbackNg,
  transitioning,
  completed,
}

@freezed
abstract class WordGameSettings with _$WordGameSettings {
  const factory WordGameSettings({
    @Default(WordGameMode.pictureToText) WordGameMode mode,
    @Default(5) int questionCount,
    @Default(4) int optionCount, // 選択肢の数（4つ固定）
  }) = _WordGameSettings;

  const WordGameSettings._();

  String get displayName => '${mode.description}（$questionCount問）';
}

@freezed
abstract class WordGameProblem with _$WordGameProblem {
  const factory WordGameProblem({
    required String word,  // 単語（例：くるま）
    required String imagePath,  // 画像パス
    required List<String> options,  // 選択肢
    required int correctIndex,  // 正解のインデックス
    required WordGameMode mode,  // ゲームモード
  }) = _WordGameProblem;

  const WordGameProblem._();

  String get questionText {
    switch (mode) {
      case WordGameMode.pictureToText:
        return 'これはなに？';
      case WordGameMode.textToPicture:
        return 'これはどれ？';
    }
  }
}

@freezed
abstract class WordGameSession with _$WordGameSession {
  const factory WordGameSession({
    required int index,
    required int total,
    required List<bool?> results,
    WordGameProblem? currentProblem,
    @Default([]) List<int> selectedIndices,  // 選択された選択肢
    @Default(0) int wrongAnswers,
  }) = _WordGameSession;

  const WordGameSession._();

  bool get isCompleted => index >= total;
  int get correctCount => results.where((r) => r == true).length;
  int get incorrectCount => results.where((r) => r == false).length;
}

@freezed
abstract class WordGameState with _$WordGameState {
  const factory WordGameState({
    @Default(WordGamePhase.ready) WordGamePhase phase,
    WordGameSettings? settings,
    WordGameSession? session,
    AnswerResult? lastResult,
    @Default(0) int epoch,
  }) = _WordGameState;

  const WordGameState._();

  bool get canAnswer => phase == WordGamePhase.questioning;
  bool get isProcessing => phase == WordGamePhase.processing || phase == WordGamePhase.transitioning;
  double get progress => session != null ? session!.index / session!.total : 0.0;
  String? get questionText => session?.currentProblem?.questionText;
}

@freezed
abstract class AnswerResult with _$AnswerResult {
  const factory AnswerResult({
    required int selectedIndex,
    required int correctIndex,
    required bool isCorrect,
    required bool isPerfect,
  }) = _AnswerResult;
}

// 共通の画像リスト
class VocabularyImages {
  static const List<String> items = [
    'あいす',
    'あさがお',
    'あり',
    'うきわ',
    'うさぎ',
    'うでどけい',
    'うま',
    'えび',
    'えんぴつ',
    'おたま',
    'おにぎり',
    'かたつむり',
    'きうい',
    'きゃべつ',
    'きりん',
    'くるま',
    'こっぷ',
    'さいころ',
    'じてんしゃ',
    'しんかんせん',
    'すずめ',
    'すにーかー',
    'すぷーん',
    'ぞう',
    'らけっと',
    'たんぽぽ',
    'ちゅーりっぷ',
    'ちりとり',
    'とまと',
    'とらくたー',
    'にんじん',
    'はさみ',
    'ばす',
    'ばなな',
    'ひこうき',
    'ふうせん',
    'ふぉーく',
    'ぶどう',
    'ふね',
    'ふらいぱん',
    'ほうき',
    'ほうちょう',
    'ぼーる',
    'ほっちきす',
    'みかん',
    'めがね',
    'めろん',
    'もみじ',
    'やかん',
    'らいおん',
    'りんご',
    'れもん',
    'れんこん',
  ];

  static String getImagePath(String word) {
    return 'assets/images/figures/vocabulary/$word.png';
  }
}